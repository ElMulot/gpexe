{% import "macros/_navbar.html.twig" as navbar %}

<ul class="navbar-nav me-auto">
	{{ navbar.item('Back', route_back) }}

	{% set admin_items = [] %}

	{% if is_granted('PROJECT_EDIT', project) %}
		{% set admin_items = admin_items|merge([
			{
				'name': 'edit.project',
				'href': path('projectEdit', {'project': project.id}),
				'data-turbo-frame': 'xl_modal',
				'data-turbo-stream-replace': 'projects',
			},
			{
				'name': 'Codification',
				'href': path('codification', {'project': project.id}),
				'data-turbo-frame': 'fs_modal',
			},
			{
				'name': 'Metadatas',
				'href': path('metadata', {'project': project.id}),
				'data-turbo-frame': 'fs_modal',
			}])
		%}
	{% endif %}

	{% if is_granted('STATUS_SHOW', project) %}
		{% set admin_items = admin_items|merge([
			{
				'name': 'Statuses',
				'href': path('status', {'project': project.id}),
				'data-turbo-frame': 'fs_modal',
			}])
		%}
	{% endif %}

	{% if is_granted('VISA_SHOW', project) %}
		{% set admin_items = admin_items|merge([
			{
				'name': 'Visas',
				'href': path('visa', {'project': project.id}),
				'data-turbo-frame': 'fs_modal',
			}])
		%}
	{% endif %}

	{% if is_granted('PROGRAM_SHOW', project) %}
		{% set admin_items = admin_items|merge([
			{
				'name': 'Programs',
				'href': path('program', {'project': project.id}),
				'data-turbo-frame': 'fs_modal',
			},
			{
				'name': 'Automations',
				'href': path('automation', {'project': project.id}),
				'data-turbo-frame': 'fs_modal',
			}])
		%}
	{% endif %}
	

	{% if admin_items is not empty %}
		{{ navbar.dropdown({'name': 'Project admin'}, admin_items) }}
	{% endif %}
</ul>

{{ navbar.title(project.name)}}

<ul class="navbar-nav ms-auto">

	{% set document_items = [] %}

	{% if is_granted('SHOW_ALL', project) %}
		{% set document_items = document_items|merge([
			{
				'name': 'All documents',
				'href': path('seriesListByBelonging', {'project': project.id, 'belong': enum('App\\Entity\\Enum\\SerieBelongingEnum::ALL').value}),
			}])
		%}
	{% endif %}

	{% if is_granted('SHOW_MDR', project) %}
		{% set document_items = document_items|merge([
			{
				'name': 'MDR only',
				'href': path('seriesListByBelonging', {'project': project.id, 'belong': enum('App\\Entity\\Enum\\SerieBelongingEnum::MDR').value}),
			}])
		%}
	{% endif %}


	{% if is_granted('SHOW_SDR', project) %}
		{% set document_items = document_items|merge([
			{
				'name': 'SDR only',
				'href': path('seriesListByBelonging', {'project': project.id, 'belong': enum('App\\Entity\\Enum\\SerieBelongingEnum::SDR').value}),
			}])
		%}
	{% endif %}

	{% if document_items is not empty %}
		{{ navbar.dropdown({'name': 'Documents'}, document_items) }}
	{% endif %}
	
	{% if is_granted('PROGRAM_PROGRESS_SHOW', project) %}

		{% set current_type = 0 %}
		{% set menu = [] %}

		{% for program in programs|sort((a, b) => a.type > b.type) %}

			{% if current_type != program.type %}
				{% set menu = menu|merge([
					{
						'name': program.type|to_string
					}
				]) %}
				{% set current_type = program.type %}
			{% endif %}

			{% set menu = menu|merge([
				{
					'name': program.name,
					'href': path('programDashboard', {'program': program.id}),
				}
			]) %}
		{% else %}
			{% set menu = [
				{
					'name': 'No program avialable',
				}
			] %}
		{% endfor %}

		{{ navbar.dropdown({'name': 'Programs'}, menu) }}

	{% endif %}

	{{ navbar.itemLogout() }}
</ul>
