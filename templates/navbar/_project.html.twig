{% import "macros/_navbar.html.twig" as navbar %}

<ul class="navbar-nav me-auto">
	{{ navbar.item('Back', route_back) }}

	{% set admin_items = [] %}

	{% if is_granted('EDIT_PROJECT', project) %}
		{% set admin_items = admin_items|merge([
			{
				'name': 'edit.project',
				'href': path('project_edit', {'project': project.id}),
				'data-turbo-frame': 'xl_modal',
			},
			{
				'name': 'Codification',
				'href': path('codification', {'project': project.id}),
				'data-turbo-frame': 'fs_modal',
			},
			{
				'name': 'Metadatas',
				'href': path('metadata', {'project': project.id}),
				'data-turbo-frame': 'fs_modal',
			}])
		%}
	{% endif %}

	{% if is_granted('SHOW_STATUS', project) %}
		{% set admin_items = admin_items|merge([
			{
				'name': 'Statuses',
				'href': path('status', {'project': project.id}),
				'data-turbo-frame': 'fs_modal',
			}])
		%}
	{% endif %}

	{% if is_granted('SHOW_VISA', project) %}
		{% set admin_items = admin_items|merge([
			{
				'name': 'Visas',
				'href': path('visa', {'project': project.id}),
				'data-turbo-frame': 'fs_modal',
			}])
		%}
	{% endif %}

	{% if is_granted('SHOW_PROGRAM', project) %}
		{% set admin_items = admin_items|merge([
			{
				'name': 'Programs',
				'href': path('program', {'project': project.id}),
				'data-turbo-frame': 'fs_modal',
			},
			{
				'name': 'Automations',
				'href': path('automation', {'project': project.id}),
				'data-turbo-frame': 'fs_modal',
			}])
		%}
	{% endif %}
	

	{% if admin_items is not empty %}
		{{ navbar.dropdown('Project admin', admin_items) }}
	{% endif %}
</ul>

{{ navbar.title(project.name)}}

<ul class="navbar-nav ms-auto">

	{% set document_items = [] %}

	{% if is_granted('SHOW_MDR', project) %}
		{% set document_items = document_items|merge([
			{
				'name': 'All documents',
				'href': path('serie_route_by_type', {'project': project.id, 'type': 'all'}),
			},
			{
				'name': 'MDR Only',
				'href': path('serie_route_by_type', {'project': project.id, 'type': 'mdr'}),
			}])
		%}
	{% endif %}


	{% if is_granted('SHOW_SDR', project) %}
		{% set document_items = document_items|merge([
			{
				'name': 'SDR Only',
				'href': path('serie_route_by_type', {'project': project.id, 'type': 'sdr'}),
			}])
		%}
	{% endif %}

	{% if document_items is not empty %}
		{{ navbar.dropdown('Documents', document_items) }}
	{% endif %}
	
	{% if is_granted('SHOW_PROGRESS_PROGRAM', project) %}

		{% set current_type = 0 %}
		{% set menu = [] %}

		{% for program in programs|sort((a, b) => a.type > b.type) %}

			{% if current_type != program.type %}
				{% set menu = menu|merge([
					{
						'name': program.type|readable_enum
					}
				]) %}
				{% set current_type = program.type %}
			{% endif %}

			{% set menu = menu|merge([
				{
					'name': program.name,
					'href': path('program_dashboard', {'program': program.id}),
				}
			]) %}
		{% else %}
			{% set menu = [
				{
					'name': 'No program avialable',
				}
			] %}
		{% endfor %}

		{{ navbar.dropdown('Programs', menu) }}

	{% endif %}

	{{ navbar.itemLogout() }}
</ul>
